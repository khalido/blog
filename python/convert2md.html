<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/tailwind.css" rel="stylesheet">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/a11y-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>

        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <title>Jupyter notebooks to markdown</title>
    </head>

    <body class="bg-yellow-100">

        <header class="bg-yellow-400 p-4 sm:p-6 md:p-8 lg:p-10 xl:p-12">
            <a href="/" 
            class="text-3xl font-mono tracking-wider font-extrabold"
            >khalido.org</a>
            <br>
            <p>every blog needs subheader text</p>
        </header>

        <!--container setting paddings-->
        <div
    class="max-w-3xl
      mx-auto
      px-4 py-5
      sm:px-6 
      md:px-7 
      lg:max-w-4xl lg:px-8
      xl:max-w-5xl xl:px-9
      bg-gray-50"
      >
 
        


<article class="prose md:prose-lg lg:prose-xl">
    <h1 id=None>Jupyter notebooks to markdown</h1>

    <details close class="fixed top-0 right-0 text-sm text-gray-500">
        <summary>Table of contents.</summary>
        <div class="toc">
<ul>
<li><a href="#nbdev">nbdev</a></li>
<li><a href="#nbconvert">nbconvert</a></li>
</ul>
</div>

    </details>
    
    <p>This is very meta, but since I only update notebooks once in a while, this here notebook converts all the notebooks in the folder to markdown files and images, which are used to build the blog posts on the site.</p>
<p>The main reason to do this is to save time when rebuilding the blog on github pages, as installing nbdev and converting all the notebooks takes a while.</p>
<p>Later on could add an option to the config to either build notebooks on each build or to just read the converted markdown files.</p>
<pre><code class="language-python">#collapse-hide
import os
from pathlib import Path
from nbdev.export2html import convert_md
import yaml

import khalido as ko # my helper utils
</code></pre>
<p>helper functions follow:</p>
<pre><code class="language-python">#collapse-hide
path_nb: Path = Path(&quot;.&quot;) # convert notebook is in the notebooks folder
path_md = path_nb / &quot;markdown&quot;

def make_folder(path, debug: bool = False):
    &quot;&quot;&quot;makes parent folders if they don't exist for a path&quot;&quot;&quot;

    # assume the last thing is a file if there is a dot in the name
    if &quot;.&quot; in path.name:
        path = path.parent

    try:
        path.mkdir(parents=True, exist_ok=False)
        if debug:
            print(f&quot;{path} folder made&quot;)
    except FileExistsError:
        if debug:
            print(f&quot;{path} folder already exists&quot;)
        pass
</code></pre>
<h2 id="nbdev">nbdev</h2>
<p>NBdev comes with a number of helpful extra features, so first up using that:</p>
<pre><code class="language-python">nb_paths = [
        f for f in path_nb.rglob(&quot;*.ipynb&quot;) if &quot;.ipynb_checkpoints&quot; not in str(f)
    ]

print(f&quot;Converting {len(nb_paths)} notebooks to markdown files.&quot;)

for i, nb_path in enumerate(nb_paths):
    print(f&quot;{i:3}: converting {nb_path}&quot;)
    path_img = path_md / f&quot;{nb_path.stem}_files&quot;
    make_folder(path_img) # make _files folder inside markdown output folder
    convert_md(nb_path, dest_path=path_md, img_path=None, jekyll=True)
    # remove extra empty files folder made by nbdev
    Path(path_img.stem).rmdir()
</code></pre>
<pre><code>Converting 11 notebooks to markdown files.
  0: converting flood_fill.ipynb



---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-7-ba477e698daf&gt; in &lt;module&gt;
      9     path_img = path_md / f"{nb_path.stem}_files"
     10     make_folder(path_img) # make _files folder inside markdown output folder
---&gt; 11     convert_md(nb_path, dest_path=path_md, img_path=None, jekyll=True)
     12     # remove extra empty files folder made by nbdev
     13     Path(path_img.stem).rmdir()


~/anaconda3/envs/blog/lib/python3.8/site-packages/nbdev/export2html.py in convert_md(fname, dest_path, img_path, jekyll)
    570     fname = Path(fname).absolute()
    571     dest_name = fname.with_suffix('.md').name
--&gt; 572     exp = nbdev_exporter(cls=MarkdownExporter, template_file='jekyll-md.tpl' if jekyll else 'md.tpl')
    573     export = exp.from_notebook_node(nb, resources=meta_jekyll)
    574     md = export[0]


~/anaconda3/envs/blog/lib/python3.8/site-packages/nbdev/export2html.py in nbdev_exporter(cls, template_file)
    486     exporter.anchor_link_text = ' '
    487     exporter.template_file = 'jekyll.tpl' if template_file is None else template_file
--&gt; 488     exporter.template_path.append(str(Path(__file__).parent/'templates'))
    489     return exporter
    490


AttributeError: 'MarkdownExporter' object has no attribute 'template_path'
</code></pre>
<p>So now in the markdown output folder we have a list of <code>.md</code> files, with each file having a <code>_files</code> folder containing output artifacts for that notebook.</p>
<pre><code class="language-python">os.listdir(path_md)
</code></pre>
<pre><code>['monte_carlo_pi_files',
 'monty_hall.md',
 'flood_fill_files',
 'us_elections_2020_files',
 'convert2md.md',
 'Advent-of-Code-2015_files',
 'Advent-of-Code-2015.md',
 'knn_files',
 'quicksort_files',
 'blogging_with_jupyter_notebooks.md',
 'blogging_with_jupyter_notebooks_files',
 'knn.md',
 'monte_carlo_pi.md',
 'convert2md_files',
 'flood_fill.md',
 'us_elections_2020.md',
 'quicksort.md',
 'monty_hall_files']
</code></pre>
<h2 id="nbconvert">nbconvert</h2>
<p>Nbconvert is usually pre-installed with jupyter notebook, so testing that out as well:</p>
<pre><code class="language-python">import nbformat
from nbconvert import MarkdownExporter
</code></pre>
<pre><code class="language-python">nb_paths = [
        f for f in path_nb.rglob(&quot;*.ipynb&quot;) if &quot;.ipynb_checkpoints&quot; not in str(f)
    ]

for nb_path in nb_paths:
    try:
        os.system(f'jupyter nbconvert --to markdown {nb_path} --output-dir markdown')
    except:
        print(f&quot;failed to convert {nb_path}&quot;)

    print(f&quot;converted {nb_path}&quot;)

</code></pre>
<pre><code>converted flood_fill.ipynb
converted knn.ipynb
converted blogging_with_jupyter_notebooks.ipynb
converted Advent-of-Code-2015.ipynb
converted monty_hall.ipynb
converted pinboard.ipynb
converted advent-of-code-2020.ipynb
converted quicksort.ipynb
converted convert2md.ipynb
converted monte_carlo_pi.ipynb
</code></pre>
<pre><code class="language-python">md_exporter = MarkdownExporter(config=c)
</code></pre>
<pre><code class="language-python">resources[&quot;outputs&quot;].keys()
</code></pre>
<pre><code>dict_keys(['output_3_0.png', 'output_7_0.png', 'output_7_1.png', 'output_7_2.png', 'output_7_3.png', 'output_7_4.png', 'output_7_5.png', 'output_7_6.png', 'output_7_7.png', 'output_7_8.png', 'output_7_9.png', 'output_7_10.png'])
</code></pre>
<pre><code class="language-python">from IPython.display import Image
Image(data=resources['outputs']['output_3_0.png'], format='png')
</code></pre>
<p><img alt="png" src="convert2md_files/convert2md_14_0.png" /></p>
<pre><code class="language-python">from traitlets.config import Config
c = Config()
#c.HTMLExporter.preprocessors = ['nbconvert.preprocessors.ExtractOutputPreprocessor']
c.MarkdownExporter.preprocessors = ['nbconvert.preprocessors.ExtractOutputPreprocessor']

</code></pre>
<pre><code class="language-python">
</code></pre>
<pre><code class="language-python">
</code></pre>

    <!-- post meta info div-->
    <div class="text-gray-600 text-base">
        posted <time>2020-11-10</time>, updated <time>2022-03-07</time><br>
        tagged: 
        <a href="/python"
        class="text-pink-500 bg-transparent hover:bg-pink-500 hover:text-white active:bg-pink-600 font-bold rounded outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150">
        python</a>

        View on: 
            <a href="https://github.com/khalido/blog/blob/master/notebooks/convert2md.ipynb">github</a>, 
            <a href="https://colab.research.google.com/github/khalido/blog/blob/master/notebooks/convert2md.ipynb">
                colab2
            </a>,
            <a href="https://deepnote.com/viewer/github/khalido/blog/blob/master/notebooks/convert2md.ipynb">deepnote</a>

        
    
    </div>
</article>

<script>hljs.highlightAll();</script>
</div> <!-- closes first div after body -->

<hr>
<footer class="px-4 py-8 content-center text-center">
    <p class="text-sm text-gray-300 pb-2">
        <a href="https://github.com/khalido/blog">#</a>
        <a href="https://twitter.com/KO">@ko</a>
    </p>
</footer>

</body>

</html>
<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/tailwind.css" rel="stylesheet">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/a11y-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>

        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <title>Book info using python</title>
    </head>

    <body class="bg-yellow-100">

        <header class="bg-yellow-400 p-4 sm:p-6 md:p-8 lg:p-10 xl:p-12">
            <a href="/" 
            class="text-3xl font-mono tracking-wider font-extrabold"
            >khalido.org</a>
            <br>
            <p>every blog needs subheader text</p>
        </header>

        <!--container setting paddings-->
        <div
    class="max-w-3xl
      mx-auto
      px-4 py-5
      sm:px-6 
      md:px-7 
      lg:max-w-4xl lg:px-8
      xl:max-w-5xl xl:px-9
      bg-gray-50"
      >
 
        


<article class="prose md:prose-lg lg:prose-xl">
    <h1 id=book-info-using-python>Book info using python</h1>

    <details close class="fixed top-0 right-0 text-sm text-gray-500">
        <summary>Table of contents.</summary>
        <div class="toc">
<ul>
<li><a href="#book-info-using-python">Book info using python</a><ul>
<li><a href="#isbnlib">isbnlib</a></li>
<li><a href="#google-books">Google books</a></li>
<li><a href="#goodreads">Goodreads</a></li>
<li><a href="#scrapy-and-selenium">Scrapy and Selenium</a></li>
</ul>
</li>
</ul>
</div>

    </details>
    
    
<p>I want to post my book reviews to this here blog, and to keep it simple, have a script pull up relevant book info. So this here is a exploration of how to to do.</p>
<p>sample book: <a href="https://www.google.com.au/books/edition/The_Uninhabitable_Earth/rNNtDwAAQBAJ?hl=en&amp;gbpv=0">The Uninhabitable Earth</a></p>
<p>First up, there are a number of ways to get book info. So trying out a few.</p>
<pre><code class="language-python">isbn = 9780141988870 # testing isbn number
</code></pre>
<h2 id="isbnlib">isbnlib</h2>
<p>This seems a reasonably popular isbn lib:
https://github.com/xlcnd/isbnlib</p>
<p><code>pip install isbnlib</code></p>
<p>isbnlib grabs info from google books by default.</p>
<pre><code class="language-python">from isbnlib import meta, cover

print(cover(str(isbn)))
meta(str(isbn))
</code></pre>
<pre><code>{'smallThumbnail': 'http://books.google.com/books/content?id=248DyAEACAAJ&amp;printsec=frontcover&amp;img=1&amp;zoom=5&amp;source=gbs_api', 'thumbnail': 'http://books.google.com/books/content?id=248DyAEACAAJ&amp;printsec=frontcover&amp;img=1&amp;zoom=1&amp;source=gbs_api'}





{'ISBN-13': '9780141988870',
 'Title': 'The Uninhabitable Earth - A Story of the Future',
 'Authors': ['David Wallace-Wells'],
 'Publisher': '',
 'Year': '2019',
 'Language': 'un'}
</code></pre>
<p>hmmm... this is so simple that I might as well try this directly.</p>
<h2 id="google-books">Google books</h2>
<p>Trying out Google books directly</p>
<pre><code class="language-python">import requests
import matplotlib.pyplot as plt
from PIL import Image
from io import BytesIO
</code></pre>
<pre><code class="language-python">def get_book_info(isbn: int):
    api = &quot;https://www.googleapis.com/books/v1/volumes?q=isbn:&quot;
    response = requests.get(f&quot;{api}{isbn}&quot;)

    # return the first item
    if response:
        all_data = response.json()[&quot;items&quot;][0]
    else:
        return False

    return all_data[&quot;volumeInfo&quot;]
    #img_url = all_data[&quot;volumeInfo&quot;][&quot;imageLinks&quot;][&quot;thumbnail&quot;]

data = get_book_info(isbn)
data
</code></pre>
<pre><code>{'title': 'The Uninhabitable Earth',
 'subtitle': 'A Story of the Future',
 'authors': ['David Wallace-Wells'],
 'publishedDate': '2019-09-05',
 'description': '**SUNDAY TIMES AND THE NEW YORK TIMES BESTSELLER** \'An epoch-defining book\' Matt Haig \'If you read just one work of non-fiction this year, it should probably be this\' David Sexton, Evening Standard Selected as a Book of the Year 2019 by the Sunday Times, Spectator and New Statesman A Waterstones Paperback of the Year and shortlisted for the Foyles Book of the Year 2019 Longlisted for the PEN / E.O. Wilson Literary Science Writing Award It is worse, much worse, than you think. The slowness of climate change is a fairy tale, perhaps as pernicious as the one that says it isn\'t happening at all, and if your anxiety about it is dominated by fears of sea-level rise, you are barely scratching the surface of what terrors are possible, even within the lifetime of a teenager today. Over the past decades, the term "Anthropocene" has climbed into the popular imagination - a name given to the geologic era we live in now, one defined by human intervention in the life of the planet. But however sanguine you might be about the proposition that we have ravaged the natural world, which we surely have, it is another thing entirely to consider the possibility that we have only provoked it, engineering first in ignorance and then in denial a climate system that will now go to war with us for many centuries, perhaps until it destroys us. In the meantime, it will remake us, transforming every aspect of the way we live-the planet no longer nurturing a dream of abundance, but a living nightmare.',
 'industryIdentifiers': [{'type': 'ISBN_10', 'identifier': '0141988878'},
  {'type': 'ISBN_13', 'identifier': '9780141988870'}],
 'readingModes': {'text': False, 'image': False},
 'pageCount': 320,
 'printType': 'BOOK',
 'categories': ['Climatic changes'],
 'averageRating': 4,
 'ratingsCount': 23,
 'maturityRating': 'NOT_MATURE',
 'allowAnonLogging': False,
 'contentVersion': 'preview-1.0.0',
 'panelizationSummary': {'containsEpubBubbles': False,
  'containsImageBubbles': False},
 'imageLinks': {'smallThumbnail': 'http://books.google.com/books/content?id=248DyAEACAAJ&amp;printsec=frontcover&amp;img=1&amp;zoom=5&amp;source=gbs_api',
  'thumbnail': 'http://books.google.com/books/content?id=248DyAEACAAJ&amp;printsec=frontcover&amp;img=1&amp;zoom=1&amp;source=gbs_api'},
 'language': 'un',
 'previewLink': 'http://books.google.com.au/books?id=248DyAEACAAJ&amp;dq=isbn:9780141988870&amp;hl=&amp;cd=1&amp;source=gbs_api',
 'infoLink': 'http://books.google.com.au/books?id=248DyAEACAAJ&amp;dq=isbn:9780141988870&amp;hl=&amp;source=gbs_api',
 'canonicalVolumeLink': 'https://books.google.com/books/about/The_Uninhabitable_Earth.html?hl=&amp;id=248DyAEACAAJ'}
</code></pre>
<p>Now to get the image cover:</p>
<pre><code class="language-python">def get_image(url: str, path=None):
    &quot;&quot;&quot;downloads image and returns it
    todo: save to disk if given a filepath&quot;&quot;&quot;

    r = requests.get(url)
    img = Image.open(BytesIO(r.content))

    if path:
        print(&quot;save to disk here&quot;)

    return img

get_image(data[&quot;imageLinks&quot;][&quot;thumbnail&quot;])
</code></pre>
<p><img alt="png" src="books_files/books_10_0.png" /></p>
<h2 id="goodreads">Goodreads</h2>
<p>Now this is the service I actually want to use, but sadly Goodreads <a href="https://help.goodreads.com/s/article/Does-Goodreads-support-the-use-of-APIs">removed</a> their <a href="https://www.goodreads.com/api">api</a> and shows no sign of bringing one back.</p>
<p>So one option is to scape goodreads. I set my prfofile visible to the world, got some url's and...</p>
<p>First trying out pandas to get the reviews table:</p>
<pre><code class="language-python">from bs4 import BeautifulSoup
from dataclasses import dataclass
import pandas as pd

@dataclass
class gr:
    &quot;stores goodreads urls&quot;
    user = &quot;https://www.goodreads.com/user/show/819075-ko&quot;
    reviews = &quot;https://www.goodreads.com/review/list/819075-ko?order=d&amp;sort=review&amp;view=reviews&quot;
    ratings = &quot;https://www.goodreads.com/review/list/819075-ko?sort=rating&amp;view=reviews&quot;

</code></pre>
<pre><code class="language-python">df = pd.read_html(gr.reviews)[1]
df = df[df.columns[2:-1]] # drop unnecessary cols
print(df.shape)
df.iloc[0]
</code></pre>
<pre><code>(30, 8)





title                                title Freedom at Midnight
author                                   author Collins, Larry
rating                                         avg rating 4.32
rating.1                          KO's rating  did not like it
my rating    my rating  1 of 5 stars2 of 5 stars3 of 5 star...
review       review  Oh goody, yet another book written thr...
read                                        date read  not set
added                                 date added  May 28, 2013
Name: 0, dtype: object
</code></pre>
<p>Pandas doesn't do a great job with the table, so moving on to <a href="https://www.crummy.com/software/BeautifulSoup/">beautiful soup</a></p>
<pre><code class="language-python">r = requests.get(gr.reviews)
soup = BeautifulSoup(r.content, 'html.parser')
</code></pre>
<pre><code class="language-python">tables = soup.find_all(&quot;table&quot;)
</code></pre>
<pre><code class="language-python">df = pd.read_html(tables[1].prettify())[0]
df.head()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>cover</th>
      <th>title</th>
      <th>author</th>
      <th>rating</th>
      <th>rating.1</th>
      <th>my rating</th>
      <th>review</th>
      <th>read</th>
      <th>added</th>
      <th>Unnamed: 10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>checkbox</td>
      <td>cover</td>
      <td>title  Freedom at Midnight</td>
      <td>author  Collins, Larry</td>
      <td>avg rating  4.32</td>
      <td>KO's rating  did not like it</td>
      <td>my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...</td>
      <td>review  Oh goody, yet another book written thr...</td>
      <td>date read  not set</td>
      <td>date added  May 28, 2013</td>
      <td>actions  view</td>
    </tr>
    <tr>
      <th>1</th>
      <td>checkbox</td>
      <td>cover</td>
      <td>title  Terra Nullius: A Journey Through No One...</td>
      <td>author  Lindqvist, Sven</td>
      <td>avg rating  4.03</td>
      <td>KO's rating  it was amazing</td>
      <td>my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...</td>
      <td>review  A great starting point on Australia, r...</td>
      <td>date read  Aug 27, 2012</td>
      <td>date added  Aug 23, 2012</td>
      <td>actions  view</td>
    </tr>
    <tr>
      <th>2</th>
      <td>checkbox</td>
      <td>cover</td>
      <td>title  Pakistan: A Hard Country</td>
      <td>author  Lieven, Anatol</td>
      <td>avg rating  4.09</td>
      <td>KO's rating  liked it</td>
      <td>my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...</td>
      <td>review  Gets some stuff right, a lot right, bu...</td>
      <td>date read  not set</td>
      <td>date added  May 01, 2011</td>
      <td>actions  view</td>
    </tr>
    <tr>
      <th>3</th>
      <td>checkbox</td>
      <td>cover</td>
      <td>title  Shameful Flight: The Last Years of the ...</td>
      <td>author  Wolpert, Stanley</td>
      <td>avg rating  4.00</td>
      <td>KO's rating  it was amazing</td>
      <td>my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...</td>
      <td>review  Best, most concise history of the inde...</td>
      <td>date read  Mar 02, 2010</td>
      <td>date added  Mar 01, 2010</td>
      <td>actions  view</td>
    </tr>
    <tr>
      <th>4</th>
      <td>checkbox</td>
      <td>cover</td>
      <td>title  Tiamat's Wrath  (The Expanse, #8)</td>
      <td>author  Corey, James S.A.  *</td>
      <td>avg rating  4.56</td>
      <td>KO's rating  liked it</td>
      <td>my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...</td>
      <td>review  Eight books into the series, it's done...</td>
      <td>date read  not set</td>
      <td>date added  Mar 16, 2019</td>
      <td>actions  view</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">df.iloc[0]
</code></pre>
<pre><code>Unnamed: 0                                              checkbox
cover                                                      cover
title                                 title  Freedom at Midnight
author                                    author  Collins, Larry
rating                                          avg rating  4.32
rating.1                            KO's rating  did not like it
my rating      my rating  1 of 5 stars  2 of 5 stars  3 of 5 ...
review         review  Oh goody, yet another book written thr...
read                                          date read  not set
added                                   date added  May 28, 2013
Unnamed: 10                                        actions  view
Name: 0, dtype: object
</code></pre>
<p>When I look at the source code in the web browser I can see that the entire review is in the table, as well as links to the cover img... so to capture this I need might need a js enabled scraper.</p>
<h2 id="scrapy-and-selenium">Scrapy and Selenium</h2>
<p>look at:</p>
<ul>
<li>https://github.com/OmarEinea/GoodReadsScraper</li>
</ul>
<p>Using the beta version as the non-beta was last updated in 2018:</p>
<p>Conda doesn't seem to have the beta version so using pip:
<code>pip install selenium==4.0.0.b4</code> </p>
<p>To get the webdriver to run, check the version of chrome installed and install the <a href="https://chromedriver.chromium.org/downloads">same version of the chromedriver</a>.</p>
<p><code>pip install "chromedriver_binary==91.0.4472.101"</code></p>
<p>If above doesn't work, try the auto binary:
<code>pip install chromedriver-binary-auto</code> # install the correct version</p>
<p>If chrome is updated, reinstall by
<code>pip install --upgrade --force-reinstall chromedriver-binary-auto</code></p>
<p>The main table I want has the css id <strong>books</strong> and class <strong>table stacked</strong> and it lazy loads as I scroll down.</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By

import chromedriver_binary  # Adds chromedriver binary to path
</code></pre>
<pre><code class="language-python">driver = webdriver.Chrome()
driver.get(&quot;http://www.python.org&quot;)
assert &quot;Python&quot; in driver.title
</code></pre>
<p>So the basics work, now moving on to using it for goodreads</p>
<pre><code class="language-python">driver = webdriver.Chrome()
driver.get(gr.reviews)
driver.title
</code></pre>
<pre><code>'KOâ€™s books on Goodreads (1,135 books)'
</code></pre>
<p>Ok need to come back to this later...</p>
<pre><code class="language-python">driver.close() # shut the browser when done
</code></pre>

    <!-- post meta info div-->
    <div class="text-gray-600 text-base">
        posted <time>2021-07-05</time>, updated <time>2022-03-07</time><br>
        tagged: 
        <a href="/python"
        class="text-pink-500 bg-transparent hover:bg-pink-500 hover:text-white active:bg-pink-600 font-bold rounded outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150">
        python</a>

        View on: 
            <a href="https://github.com/khalido/blog/blob/master/notebooks/books.ipynb">github</a>, 
            <a href="https://colab.research.google.com/github/khalido/blog/blob/master/notebooks/books.ipynb">
                colab2
            </a>,
            <a href="https://deepnote.com/viewer/github/khalido/blog/blob/master/notebooks/books.ipynb">deepnote</a>

        
    
    </div>
</article>

<script>hljs.highlightAll();</script>
</div> <!-- closes first div after body -->

<hr>
<footer class="px-4 py-8 content-center text-center">
    <p class="text-sm text-gray-300 pb-2">
        <a href="https://github.com/khalido/blog">#</a>
        <a href="https://twitter.com/KO">@ko</a>
    </p>
</footer>

</body>

</html>